<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Menu</title>
        <link rel='stylesheet prefetch' href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css'>
        <link rel="stylesheet" href="menu-to-all.css">
    </head>
    <body >
        <section class="menuM menu--circle preload">
            <input type="checkbox" id="menu__active" class="menuMInputs">
            <label for="menu__active" class="menu__active">
                <div class="menu__toggle">
                    <div class="iconM">
                        <div class="hamburgerM"></div>
                    </div>
                </div>
                <input type="radio" name="arrowM--up" id="degree--up-0" class="menuMInputs">
                <div class="menu__listings">
                    <ul class="circleM">
                        <li>
                            <div class="placeholderM">
                                <div class="upsideM">
                                    <a href="#" class="buttonM"><i class="fa fa-user"></i></a>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="placeholderM">
                                <div class="upsideM">
                                    <div class="upsideSubM">
                                        <a href="#" class="buttonSubM"><i class="fa fa-cog"></i></a>
                                    </div>
                                    <div class="upsideSubM">
                                        <a href="#" class="buttonSubM"><i class="fa fa-cog"></i></a>
                                    </div>
                                    <a href="#" class="buttonM"><i class="fa fa-cog"></i></a>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="placeholderM">
                                <div class="upsideM">
                                    <a href="#" class="buttonM"><i class="fa fa-commenting"></i></a>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="placeholderM">
                                <div class="upsideM">
                                    <a href="#" class="buttonM"><i class="fa fa-trash"></i></a>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="menu__arrowM menu__arrowM--top">
                    <label for="degree--up-0"><div class="arrowM"></div></label>
                </div>
            </label>
        </section>
    </body>
    <script>
        var menu = document.querySelector(".preload"),
            menu__toggle = document.querySelector(".menu__toggle"),
            arrowM = document.querySelector(".arrowM"),
            menu__listings = document.querySelector(".menu__listings"),
            rotateAdded = false,
            currentElem = null,
            deg = 0,
            subMenus;
            
        menu.classList.remove('preload');

        menu__toggle.addEventListener('click', addRotateEvent);

        function addRotateEvent() {
            if(!rotateAdded) {
                rotateAdded = !rotateAdded;
                arrowM.addEventListener('click', rotateMenu);
                menu__listings.addEventListener('mouseover', showSubmenu);
                menu__listings.addEventListener('mouseout', hideSubmenu);
            } else {
                rotateAdded = !rotateAdded;
                arrowM.removeEventListener('click', rotateMenu);
                menu__listings.removeEventListener('mouseover', showSubmenu);
                menu__listings.removeEventListener('mouseout', hideSubmenu);
                deg = 0;
                menu__listings.style.webkitTransform = null; 
                menu__listings.style.mozTransform    = null; 
                menu__listings.style.msTransform     = null; 
                menu__listings.style.oTransform      = null; 
                menu__listings.style.transform       = null;
            }
        }

        function rotateMenu() {
            deg += 60;
            menu__listings.style.webkitTransform = 'rotate(' + deg + 'deg)'; 
            menu__listings.style.mozTransform    = 'rotate(' + deg + 'deg)'; 
            menu__listings.style.msTransform     = 'rotate(' + deg + 'deg)'; 
            menu__listings.style.oTransform      = 'rotate(' + deg + 'deg)'; 
            menu__listings.style.transform       = 'rotate(' + deg + 'deg)';  
        }

        function showSubmenu() {
            if (currentElem) {
                return;
            }

            var target = event.target;

            while (target != this) {
                if (target.className == 'upsideM') break;
                target = target.parentNode;
            }
            if (target == this) return;
            currentElem = target;

            subMenus = target.querySelectorAll('.upsideSubM');
            for(var i = 0; i < subMenus.length; i++) {
                subMenus[i].classList.add('submenu');
            }
        }

        function hideSubmenu() {
            if (!currentElem) return;

            var relatedTarget = event.relatedTarget;
            if (relatedTarget) {
                while (relatedTarget) {
                    if (relatedTarget == currentElem) return;
                    relatedTarget = relatedTarget.parentNode;
                }
            }

            for(var i = 0; i < subMenus.length; i++) {
                subMenus[i].classList.remove('submenu');
            }

            currentElem = null;
        }
    </script>
</html>